# 计算机系统概述（OS part 1）

## I.操作系统概念和功能

### 概念
操作系统是指控制和**管理**整个计算机系统的**硬件和软件**资源， 并合理地组织调度计算机的工作和资源分配， 以**提供给用户和其他软件方便的接口和环境**， 它是计算机系统中最基本的**系统软件**

### 功能
#### 1.系统资源管理

- 处理机管理
- 存储器管理
- 文件管理
- 设备管理

#### 2.向上层提供方便易用的服务

操作系统把硬件功能封装成简单易用的服务，使用户能更方便地使用计算机，用户无需关系底层硬件的原理，只需要对操作系统发出命令即可

1. GUI 图形化用户接口（Graphical User Interface）
2. 联机命令接口（交互式命令接口）
3. 脱机命令接口（批处理命令接口）
4. 程序接口  在程序代码中进行**系统调用**来使用程序接口， 比如 printf 函数

#### 3.对硬件机器的扩展

没有任何软件支持的计算机成为**裸机**。在裸机上安装的操作系统， 可以提供资源管理功能和方便用户的服务功能，将裸机改造成功能 更强、使用更方便的机器 通常把覆盖了软件的机器成为**扩充机器**，又称之为**虚拟机**

操作系统对硬件机器的拓展：将CPU、内存、磁盘、显示器、键盘等硬件合理地组织起来，让各种硬件 能够相互协调配合，实现更多更复杂的功能 普通用户无需关心这些硬件在底层是怎么组织起来工作的，只需直接使用操作系统提供的接口即可

---



## II.操作系统的特征

### 1.并发

**操作系统的并发性**指计算机系统中“同时”运行着多个程序，这些程序宏观上看是同时运行着的，而微观 上看是交替运行的。
操作系统就是伴随着“多道程序技术”而出现的。因此，**操作系统和程序并发是一起诞生的**。
**单核CPU**同一时刻只能执行一个程序，各个程序只能并发地执行
**多核CPU**同一时刻可以同时执行多个程序，多个程序可以并行地执行

并发： one coffee machine two lines 

并行：two coffee machine two lines

### 2.共享

共享即资源共享，是指系统中的资源可供内存中多个并发执行的进程共同使用。

1. 互斥共享方式
   - 系统中的某些资源，虽然可以提供给 多个进程使用，**但一个时间段内只允 许一个进程访问该资源**
2. 同时共享方式
   - 系统中的某些资源，**允许一个时间段 内由多个进程“同时”对它们进行访问** 

### 2.5 并发和共享的关系

并发和共享是操作系统两个最基本的特征，**两者互为存在条件**

如果失去并发性，则系统中同一时间只有一个程序运行， 那么共享性就失去了存在的意义

如果失去共享性，则系统中并发的程序就无法同时访问系统资源， 也就无法实现并发了

### 3.虚拟

虚拟是指把一个物理上的实体变为若干个逻辑上的对应物。物理实体（前者）是实际存在的，而逻辑上 对应物（后者）是用户感受到的。

虚拟技术：

1. 空分复用技术 （比如虚拟存储器技术）
2. 时分复用技术 （比如虚拟处理器）

显然，如果失去了并发性，则一个时间段 内系统中只需运行一道程序，那么就失去 了实现虚拟性的意义了。因此，没有并发 性，就谈不上虚拟性

### 4.异步

异步是指，在多道程序环境下，允许多个程序并发执行，但由于资源有限，进程的执行不是一贯到底的， 而是走走停停，以不可预知的速度向前推进，这就是进程的异步性。

如果失去了并发性，即系统只能串行地 运行各个程序，那么每个程序的执行会 一贯到底。只有系统拥有并发性，才有 可能导致异步性。

---

## III.操作系统的发展与分类

**5、6、7 了解即可**

1. 手工操作阶段

   - 通过纸带机进行输入输出，计算机利用率低， 用户独占全机，人机速度矛盾导致资源利用率极低

2. 批处理阶段

   1. 单道批处理系统
      - 引入脱机输入输出技术（用外围机+磁带完成）， 并由监督程序负责控制作业的输入输出
      - 通过外围机把程序提前存到磁带里，磁带的读写速度比纸带机快很多
      - 缓解了一定程度的人机速度矛盾，资源利用率有所提高
      - 缺点是内存中只能有一道程序运行，只有当前程序运行结束后才能调入下一道程序，CPU 有大量时间实在空闲等待 IO 完成
   2. 多道批处理系统（操作系统开始出现）
      - 每次往内存红读入多道程序， 并且操作系统正式诞生，用于支持多道程序并发运行
      - 多道程序并发执行，共享计算机资源，资源利用率大幅提高，cpu 和其他资源更能保持忙碌状态，系统吞吐量增大
      - 缺点是用户响应时间长，没有人机交互功能（单道一样有）

3. 分时操作系统

   - 计算机以时间片为单位轮流为各个用户/作业服务，各个用户可通过终端与计算机进行交互。 主要优点：用户请求可以被即时响应，解决了人机交互问题。允许多个用户同时使用一台计算机，并且用 户对计算机的操作相互独立，感受不到别人的存在。
   - 缺点是不能优先处理一些紧急任务。操作系统对各个用户/作业都是完全公平的，循环地为每个用户/ 作业服务一个时间片，不区分任务的紧急性

4. 实时操作系统

   - 能够优先响应一些紧急任务，某些紧急任务不需时间片排队。在实时操作系统的控制下，计算机系统接收到外部信号后及时进行处理，并且要在严格的时限内处理完事 件。实时操作系统的主要特点是及时性和可靠性
   - 分为硬实时和软实时系统
     1. 硬实时系统， 必须在绝对严格的规定时间内完成处理， 比如导弹控制系统，自动驾驶系统
     2. 软实时系统， 能接受偶尔违反时间规定， 比如 12306 订票系统

5. 网络操作系统
   - 是伴随着计算机网络的发展而诞生的，能把网络中各个计算机有机地结合起来，实现数据传 送等功能，实现网络中各种资源的共享（如文件共享）和各台计算机之间的通信。（如：Windows NT 就是 一种典型的网络操作系统，网站服务器就可以使用）

6. 分布式操作系统
   - 主要特点是分布性和并行性。系统中的各台计算机地位相同，任何工作都可以分布在这些 计算机上，由它们并行、协同完成这个任务。

7. 个人计算机操作系统
   -  Windows XP、MacOS，方便个人使用


---

## IV.操作系统的运行机制

### 1.运行机制

#### 1.特权&非特权指令

1. 特权指令
   - 是指不允许用户直接使用的指令，比如 I/O指令、置中断指令，存取用于内存保护的寄存器、送程序状态字到状态字寄存器等的指令
2. 非特权指令
   - 是指允许用户直接使用的指令，它不能直接访问系统中的软硬件资源，仅限于访问用户的地址空间，这也是为了防止用户程序对系统造成破坏。

在CPU设计和生产的时 候就划分了特权指令和 非特权指令，因此CPU 执行一条指令前就能判 断出其类型

#### 2.内核态&用户态

CPU 有两种状态，“**内核态**”和“**用户态**”。 

处于**内核态时**，说明此时正在运行的是内核程序，此时**可以执行特权指令** ， 内核态又称 **核心态、管态**

处于**用户态时**，说明此时正在运行的是应用程序，此时**只能执行非特权指令**， 用户态又称 **目态**

**内核态与用户态的切换**

1. 内核态 -> 用户态：**执行一条特权指令, 修改PSW的标志位为“用户态”**，这个动作意味着操作系统将主动让出CPU使用权
2. 用户态 -> 内核态：**由“中断”引发**，硬件自动完成变态过程，触发中断信号意味着操作系统将强行夺 回CPU的使用权
   1. 除了非法使用特权指令之外，还有很多事件 会触发中断信号。一个共性是，但凡需要操 作系统介入的地方，都会触发中断信号

#### 3.内核程序&应用程序

1. 内核程序
   1. 操作系统的内核程序是系统的管理者， 既可以执行特权指令，也可以执行非特 权指令，运行在核心态。
2. 应用程序
   1. 为了保证系统能安全运行，普通应用程 序只能执行非特权指令，运行在用户态

### 2.操作系统内核

<img src="https://ryansimg.oss-cn-shanghai.aliyuncs.com/2021/202309110004693.png" alt="image-20230911000402497" style="zoom:25%;" />

**1.时钟管理**

- 时钟的第一功能是计时，操作系统需要通过时钟管理，向用户提供标准的系统时间。
- 另外，通过时钟中断的管理，可以实现进程的切换。例如，在分时操作系统中采用时间片轮转调度，在实时系统中按截止时问控制运行，在批处理系统中通过时钟管理来衡量一个作业的运行程度等

**2.中断处理**

- 引入中断技术的初衷是提高多道程序运行环境中 CPU 的利用率，而且主要是针对外部设备的。后来逐步得到发展，形成了多种类型，成为操作系统各项操作的基础。例奶，键盘或鼠标信息的输入、进程的管理和调度、系统功能的调用、设备驱动、文件访问等，无不依赖于中断机制。可以说，现代操作系统是靠中断驱动的软件。
- 中断机制中，只有一小部分功能属于内核，它们负责保护和恢复中断现场的信息，转移控制权到相关的处理程序。这样可以减少中断的处理时间，提高系统的并行处理能力

**3.原语**

原语 (Atomic Operation)。定义原语的直接方法是关闭中断，让其所有动作不可分割地完成后再打开中断。系统中的设备驱动、CPU 切换、进程通信等功能中的部分操作都可定义为原语，使它们成为内核的组成部分。

- 处于操作系统的最底层，是最接近硬件的部分。
- 这些程序的运行具有原子性，其操作只能一气呵成（出于系统安全性和便于管理考虑）。
- 这些程序的运行时间都较短，而且调用频繁。

**4.等系统资源进行管理的功能**

系统中用来登记状态信息的数据结构很多，如作业控制块、进程控制块 (PCB)、设备控制块、各类链表、消息队列、缓冲区、空闲区登记表、内存分配表等。为了实现有效的管理，系统需要一些基本的操作，常见的操作有以下了种：

1. 进程管理。进程状态管理、进程调度和分派、创建与撤销进程控制块等。
2. 存储器管理。存储器的空间分配和回收、内存信息保护程序、代码对换程序等。
3. 设备管理。缓冲区管理、设备分配和回收等。

### 3.操作系统体系结构

1.宏内核

- 将操作系统的主要功能模块都作为系统内核，运行在核心态
- 优点：高性能;  缺点：内核代码庞大，结构混乱，难以维护

2.微内核

- 只把最基本的功能保留在内核
- 优点：内核功能少，结构清晰，方便维护;    缺点：需要预繁地在核心态和用户态之问切换，性能低
